#!/bin/bash

# Function to ping a single IP
ping_ip() {
    local ip=$(echo $1 | cut -d "," -f 1)
    local timeout="${2:-3}"  # Default timeout of 3 seconds if not specified
    local result
    result=$(ping -qc2 -W "$timeout" "$ip" | awk -F '/' 'END{ print (/^rtt/? $5:"FAIL") }')
        echo "$1" "$result"
}

# Export the function so it can be used by parallel
export -f ping_ip

# Main script
main() {

    # Check for GNU Parallel
    if ! command -v parallel &> /dev/null; then
        echo "Error: GNU Parallel is required. Please install it:"
        echo "  On Debian/Ubuntu: sudo apt-get install parallel"
        echo "  On CentOS/RHEL: sudo yum install parallel"
        echo "  On macOS with Homebrew: brew install parallel"
        exit 1
    fi

    # Ping IPs in parallel
    echo "Pinging IPs from $ip_file..."
    cat list.txt | parallel -j10 ping_ip
    echo "Ping completed."
}

# Run the main function with the provided IP list file
main "$@"
